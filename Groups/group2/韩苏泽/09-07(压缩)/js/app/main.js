define("utils",[],function(){var t=function(){var t={},e={},i=function(){var n=Array.prototype.shift.call(arguments),r=this,o=arguments;if(t[n]&&t[n].length>0){var a=t[n];a.forEach(function(t){t.apply(r,o)})}else{e[n]||(e[n]=[]);var s=function(){return i.apply(r,o)};e[n].push(s)}},n=function(i,n){if(t[i]||(t[i]=[]),t[i].push(n),e[i]&&e[i].length>0){var r=e[i];r.forEach(function(t){t()})}},r=function(e,i){if(t[e]&&t[e].length>0){var n=t[e];if(!i)return void(t[e].length=0);for(var r=n.length-1;r>=0;r--){var o=n[r];o===i&&n.splice(r,1)}}};return{fire:i,listen:n,off:r}}(),e=function(t,e){var i=null;return e=e||200,function(){var n=this,r=arguments;i&&clearTimeout(i),i=setTimeout(function(){t.apply(n,r)},e)}},i=function(t){return"object"==typeof t&&Number.isFinite(t.length)&&t.length>=0&&Math.floor(t.length)===t.length&&t.length<Math.pow(2,32)-1?!0:!1},n=function(t,e){if(i(t))for(var n=0,r=t.length;r>n;n++)e.call(t[n],t[n],n);else if("object"==typeof t)for(var n in t)e.call(t[n],t[n],n)};return{Event:t,throttleFactory:e,each:n}}),define("mock",["utils"],function(t){var e=function(e,n,r){var o=function(){return"register"===e?(t.each(n,function(t,e){window.localStorage["bishe3"+e]=t}),i[e]):"login"===e&&(n.username!==window.localStorage.bishe3username&&n.username!==window.localStorage.bishe3email||n.password!==window.localStorage.bishe3password)?{state:2,error:"用户名或密码错误"}:i[e]};setTimeout(function(){var t=o();return t&&"function"==typeof r?void r(t):void r({state:1,error:"找不到该请求"})},500)},i={flyMonster:{state:0,data:[{data:"今晚方方老师讲浮动，大家快来围观!",type:"class"},{data:"今晚若愚老师讲ajax,大家快来围观!",type:"class"},{data:"明晚8点半，若愚老师讲如何找工作,大家快来围观!",type:"class"},{data:"明晚8点半，方方老师讲Node.js，大家快来围观!",type:"class"}]},register:{state:0,data:"注册成功"},login:{state:0,data:{msg:"欢迎回来!"+window.localStorage.bishe3username,imgsrc:"./images/small.jpg",name:window.localStorage.bishe3username}}};return{getHttpData:e}}),define("flyMonster",["jquery","utils"],function(t,e){var i=function(t){this.$container=t,this.messagegQueue=[],this.maxLen=4,this.clock=null,this.num=0};return i.prototype.add=function(t){this.messagegQueue.push(t)},i.prototype.append=function(e){var i,n,r="";r+='<div class="notice">',r+='<a class="notice-ct" href="javascript:void(0)"></a>',r+='<div class="icon-notice"></div>',r+="</div>",i=t(r),i.find(".notice-ct").text(e.data).attr("title",e.data),n=this.num++%this.maxLen,i.find(".icon-notice").addClass("icon-notice"+n),"weather"===e.type&&i.find(".icon-notice").addClass("weather"),i.addClass("notice-top"+n).addClass("notice-move").addClass("move"+n),t(".layer-notice").append(i)},i.prototype.startFly=function(){var t=this;this.clock||(this.append(this.messagegQueue.shift()),this.clock=setInterval(function(){t.messagegQueue.length>0?t.append(t.messagegQueue.shift()):clearInterval(t.clock)},6e3))},i.prototype.init=function(){this.startFly()},{create:function(t){var e=new i(t);return e}}}),define("moveMountainFactory",["jquery"],function(t){var e=function(e,i){var n={};n.moveBoxs=e||[],n.moveFactor=i||100;var r=function(){a()},o=function(){var e,i=t(window);return e={x:i.width()/2,y:(i.scrollTop()+i.height())/2}},a=function(){t(window).on("mousemove",function(t){u(t)})},s=function(t,e){for(var i=0,n=t.length;n>i;i++){var r=e.call(t[i],t[i],i);if(r===!1)break}},u=function(t){var e=o(),i=(t.pageX-e.x)/n.moveFactor,r=(t.pageY-e.y)/n.moveFactor;s(n.moveBoxs,function(e){var n,o,a,s=e.$item,u=e.factor;return s.offset().top+s.outerHeight()<t.pageY||s.offset().top>t.pageY?!1:(n=(u||1)*i,o=(u||1)*r,a="translate("+n+"px,"+o+"px)",void s.css("transform",a))})};return{init:r}};return e}),define("CarsouelFactory",["jquery","utils"],function(t,e){var i=function(){var t=function(){};return t.prototype.setOpts=function(t){var i=this;e.each(t,function(t,e){i[e]=t})},t.prototype.properties={$screen:"用来定义carsouel的演示框",$lists:"存放图片的区域,通过改变left属性实现移动",width:"图片的统一宽度",curIdx:"计数器,一般从零开始"},t.prototype.checkOpts=function(){var t=this;e.each(t.properties,function(e,i){if(!(i in t))throw new Error("子类必须定义"+i+"属性 msg:"+e)})},t.prototype.initState=function(){throw new Error("子类必须实现 initState 方法")},t.prototype.bindEvent=function(){throw new Error("子类必须实现 bindEvent方法")},t.prototype.playNext=function(t,e,i){if(this.$screen.data("playing"))return!1;var t=t||1,n=this,i=i||"fast";this.$screen.data("playing",!0),this.$container.animate({left:"-="+n.width*t},i,function(){n.$screen.removeData("playing"),"function"==typeof e&&e()}),n.curIdx+=t},t.prototype.playPrev=function(t,e,i){if(this.$screen.data("playing"))return!1;var t=t||1,n=this,i=i||"fast";this.$container.animate({left:"+="+n.width*t},i,function(){n.$screen.removeData("playing"),"function"==typeof e&&e()}),n.curIdx-=t},t.prototype.init=function(t){this.setOpts(t),this.checkOpts(),this.initState(),this.bindEvent()},{create:function(){return new t}}}();return i}),define("CarsouelModel",["jquery","utils","CarsouelFactory"],function(t,e,i){var n=function(t){this.carsouel=t,this.maxWidth=768,this.minWidth=320,this.col=2};n.prototype.initState=function(){var e,i,n,r=this.carsouel,o=t("#content");console.log(o.width(),this.maxWidth,i),i=Math.min(o.width(),this.maxWidth),i=Math.max(i,this.minWidth),r.width=i/this.col,r.$screen.width(i),r.$screen.height(r.width),e=r.$lists.size(),r.$container.width(e*r.width),r.$container.height(r.width),n="-"+r.curIdx*r.width+"px",r.$container.css("left",n),r.$lists.css("width",r.width),r.$lists.css("height",r.width),r.$lists.removeClass("scale"),r.$prev.addClass("disable"),r.setDisable(this.col)},n.prototype.statePlayPrev=function(){var t=this.carsouel;t.checkPrev()&&(t.playPrev(void 0,void 0,"0.3s"),t.setDisable(this.col))},n.prototype.statePlayNext=function(){var t=this.carsouel;t.checkNext()&&(t.playNext(void 0,void 0,"0.3s"),t.setDisable(this.col))};var r=function(t){this.carsouel=t,this.maxWidth=1400,this.minWidth=769,this.col=3};r.prototype.initState=function(){var e,i,n,r=this.carsouel,o=r.$lists.size()-1,a=r.curIdx+1,s=t("#content");a===o&&(a-=1,r.curIdx=r.curIdx-1),i=Math.min(s.width(),this.maxWidth),i=Math.max(i,this.minWidth),r.width=i/this.col,r.$screen.width(i),r.$screen.height(r.width),e=r.$lists.size(),r.$container.width(e*r.width),r.$container.height(r.width),n="-"+r.curIdx*r.width+"px",r.$container.css("left",n),r.$lists.css("width",r.width),r.$lists.css("height",r.width),r.$lists.eq(a).addClass("scale"),r.$prev.addClass("disable"),r.setDisable(this.col)},r.prototype.statePlayPrev=function(){var t=this.carsouel;t.checkPrev()&&(t.playPrev(void 0,void 0,"0.3s"),t.setPrevState(),t.setDisable(this.col))},r.prototype.statePlayNext=function(){var t=this.carsouel;t.checkNext()&&(t.playNext(void 0,void 0,"0.3s"),t.setNextState(),t.setDisable(this.col))};var o=function(){var o=function(){this.curState=null,this.twoColState=new n(this),this.threeColState=new r(this)};return o.prototype=i.create(),o.prototype.initState=function(){var e=t("#content").width();e>this.twoColState.maxWidth?this.curState=this.threeColState:this.curState=this.twoColState,this.curState.initState()},o.prototype.bindEvent=function(){var i=this;this.$prev.on("click",function(){i.curState.statePlayPrev()}),this.$next.on("click",function(){i.curState.statePlayNext()}),t(window).on("resize",e.throttleFactory(function(){i.initState()},100))},o.prototype.checkPrev=function(){return this.$prev.hasClass("disable")?!1:!0},o.prototype.setDisable=function(t){var e=this.$lists.size();this.curIdx<=0?this.$prev.addClass("disable"):this.$prev.removeClass("disable"),this.curIdx+t>=e?this.$next.addClass("disable"):this.$next.removeClass("disable")},o.prototype.checkNext=function(){return this.$next.hasClass("disable")?!1:!0},o.prototype.setPrevState=function(){var t=this.curIdx+1;this.$lists.eq(t+1).removeClass("scale"),this.$lists.eq(t).addClass("scale")},o.prototype.setNextState=function(){var t=this.curIdx+1;this.$lists.eq(t-1).removeClass("scale"),this.$lists.eq(t).addClass("scale")},{create:function(){return new o}}}();return o}),define("bigEventModel",["jquery","utils","CarsouelFactory"],function(t,e,i){var n=function(){var n=function(){this.prevQueue=[],this.nextQueue=[]};return n.prototype=i.create(),n.prototype.initState=function(){var e;this.$prev.addClass("disable"),this.$lists.width(t(window).width()),e=this.$lists.size(),this.$container.width(e*this.width)},n.prototype.checkPrev=function(){return this.$prev.hasClass("disable")?!1:!0},n.prototype.checkNext=function(){return this.$next.hasClass("disable")?!1:!0},n.prototype.setDisable=function(){var t=this.$lists.size();this.curIdx<=0?this.$prev.addClass("disable"):this.$prev.removeClass("disable"),this.curIdx+1>=t?this.$next.addClass("disable"):this.$next.removeClass("disable")},n.prototype.playPrevQueue=function(t){var i,n=this,r=t?t-this.curIdx:void 0;if(!(r>=0)&&this.checkPrev()){if(i=this.playPrev(Math.abs(r),function(){e.Event.fire("carsouelMove",n.curIdx),n.executePrevQueue()}),i!==!1)return void this.setDisable();this.prevQueue.length>2&&this.prevQueue.shift();var o=function(t){return function(){n.playPrevQueue(t)}}(t);this.prevQueue.push(o)}},n.prototype.playNextQueue=function(t){var i,n=this,r=t?t-this.curIdx:void 0;if(!(0>=r)&&this.checkNext()){if(i=this.playNext(r,function(){e.Event.fire("carsouelMove",n.curIdx),n.executeNextQueue()}),i!==!1)return void this.setDisable();this.nextQueue.length>2&&this.nextQueue.shift();var o=function(t){return function(){n.playNextQueue(t)}}(t);this.nextQueue.push(o)}},n.prototype.executePrevQueue=function(){this.prevQueue.length&&this.prevQueue.shift()()},n.prototype.executeNextQueue=function(){this.nextQueue.length&&this.nextQueue.shift()()},n.prototype.bindEvent=function(){var i=this;this.$prev.on("click",function(){return i.checkPrev()&&(ret=i.playPrev(void 0,function(){e.Event.fire("carsouelMove",i.curIdx)}),ret!==!1)?void i.setDisable():void 0}),this.$next.on("click",function(){return i.checkNext()&&(ret=i.playNext(void 0,function(){e.Event.fire("carsouelMove",i.curIdx)}),ret!==!1)?void i.setDisable():void 0}),t(window).on("resize",e.throttleFactory(function(){var e,n=i.$lists.size();i.width=t(window).width(),i.$lists.outerWidth(i.width),i.$container.width(n*i.width),e="-"+i.curIdx*i.width+"px",i.$container.css("left",e)},10)),e.Event.listen("timelineMove",function(t){var e=t-i.curIdx;e>0&&i.playNextQueue(t),0>e&&i.playPrevQueue(t)})},{create:function(){return new n}}}();return n}),define("app/validataFn",[],function(){var t=function(){this.cache=[]};t.prototype.add=function(t,e){for(var n,r=(t.value.trim(),this),o=0;n=e[o];o++)!function(e){r.cache.push(function(){var n=e.stragegy.split(":"),r=n.shift();return n.unshift(t.value),n.push(e.errorMsg),i[r].apply(t,n)})}(n)},t.prototype.start=function(){for(var t,e=0;t=this.cache[e];e++){var i=t();if(i)return i}};var e=function(e){var i=new t;i.add(e.email,[{stragegy:"isEmail",errorMsg:"邮箱格式不正确"}]),i.add(e.username,[{stragegy:"isNoEmpty",errorMsg:"用户名不能为空"}]),i.add(e.pwd,[{stragegy:"isNoEmpty",errorMsg:"密码不能为空"},{stragegy:"minLength:6",errorMsg:"密码不能小于6位"}]);var n=i.start();return n?n:void 0},i={isNoEmpty:function(t,e){return""===t?e:void 0},minLength:function(t,e,i){return t.length<e?i:void 0},isEmail:function(t,e){return/^\w+@[A-Za-z0-9]+\.\w{2,3}$/.test(t)?void 0:e}};return e}),define("msgInfo",["jquery","utils"],function(t,e){var i=function(){var i=0,n=function(){var n=Array.prototype.shift.call(arguments),r=arguments;e.each(r,function(e){var r=t('<div class="msg-info fa"></div>');r.text(" "+e),r.css("top",80*i+10+"px").addClass(n),i++,t(document.body).append(r),setTimeout(function(){r.remove(),i--},3e3)})};return{error:function(){Array.prototype.unshift.call(arguments,"error"),n.apply(this,arguments)},log:function(){Array.prototype.unshift.call(arguments,"log"),n.apply(this,arguments)}}}();return i}),define("dialogModel",["jquery","utils","mock","app/validataFn","msgInfo"],function(t,e,i,n,r){var o=function(){var t=function(){};return t.prototype.show=function(){this.$dialogModel.removeClass("hidden"),this.$dialog.animate({top:30},"fast")},t.prototype.hide=function(){this.$dialogModel.addClass("hidden"),this.$dialog.css("top",0)},t.prototype.bindEvent=function(){throw new Error("子类必须实现bindEvent方法")},t.prototype.setOpts=function(t){var i=this;e.each(t,function(t,e){i[e]=t})},t.prototype.init=function(t){this.setOpts(t),this.bindEvent()},{create:function(){var e=new t;return e}}}(),a=function(){var n=function(){};return n.prototype=o.create(),n.prototype.loginSubmit=function(n){var o,a=this,s=t(n);s.data("submit")||(s.data("submit",!0),o={username:n.username.value,password:n.pwd.value},i.getHttpData("login",o,function(t){0===t.state?(e.Event.fire("login",t.data),r.log(t.data.msg),a.hide()):r.error(t.error),s.removeData("submit")}))},n.prototype.bindEvent=function(){var t=this;this.$dialog.find(".header .close").on("click",function(){t.hide()}),this.$dialog.find("form").on("submit",function(e){t.loginSubmit(this),e.preventDefault()})},{create:function(t){var e=new n;return e.init(t),e}}}(),s=function(){var e=function(){};return e.prototype=o.create(),e.prototype.registerSubmit=function(e){var o,a,s=t(e),u=this;if(!s.data("submit")){if(a=n(e))return r.error(a);s.data("submit",!0),o={email:e.email.value,username:e.username.value,password:e.pwd.value},i.getHttpData("register",o,function(t){0===t.state?(r.log(t.data),u.hide()):r.error(t.error),s.removeData("submit")})}},e.prototype.bindEvent=function(){var t=this;this.$dialog.find(".header .close").on("click",function(){t.hide()}),this.$dialog.find("form").on("submit",function(e){t.registerSubmit(this),e.preventDefault()})},{create:function(t){var i=new e;return i.init(t),i}}}();return{loginDialog:a,registerDialog:s}}),define("app/dialog",["jquery","utils","dialogModel","msgInfo"],function(t,e,i,n){var r=i.loginDialog.create({$dialogModel:t("#login-dialog"),$dialog:t("#login-dialog").find(".dialog")}),o=i.registerDialog.create({$dialogModel:t("#register-dialog"),$dialog:t("#register-dialog").find(".dialog")}),a={$node:t(".layer-nav .child-nav.tourist"),loginDialog:r,registerDialog:o,bindEvent:function(){var t=this;this.$node.find("#login").on("click",function(){t.loginDialog.show()}),this.$node.find("#register").on("click",function(){t.registerDialog.show()})},show:function(){this.$node.removeClass("hidden")},hide:function(){this.$node.addClass("hidden")}},s={$node:t(".layer-nav .userinfo"),show:function(e){var i='<img src="'+e.imgsrc+'" class="small"><span>'+e.name+"</span>";this.$node.find(".user").append(t(i)),this.$node.removeClass("hidden")},hide:function(){this.$node.find(".user").html(""),this.$node.addClass("hidden")}},u=function(){(function(){a.bindEvent(),e.Event.listen("login",function(e){t(".layer-nav .userSwicth").find(">a").text("我"),s.show(e),a.hide()}),t(".layer-nav .userinfo").find("#cancel-login").on("click",function(){t(".layer-nav .userSwicth").find(">a").text("登入"),a.show(),s.hide(),n.log("用户已注销")})})();t(".layer-nav .userSwicth").find(">a").text("登入"),a.show(),s.hide()};return{init:u}}),requirejs.config({baseUrl:"js/lib",paths:{app:"../app",jquery:"http://apps.bdimg.com/libs/jquery/1.9.1/jquery",mock:"../server/mock"}}),requirejs(["jquery"],function(t){t(".monster-talk").find("img").on("mouseenter",function(){t(this).attr("src","./images/talk.gif")}),t(".monster-talk").find("img").on("mouseleave",function(){t(this).attr("src","./images/talk.png")})}),requirejs(["jquery","mock","flyMonster"],function(t,e,i){var n=i.create();e.getHttpData("flyMonster",void 0,function(t){if(0===t.state){var e=t.data;e.forEach(function(t){n.add(t)}),n.init()}}),t.ajax({url:"http://api.jirengu.com/weather.php",method:"GET",dataType:"jsonp",callback:"jQuery30004158580127859153_1471508661958",data:{_:1471508661959}}).done(function(t){if("success"===t.status){var e=t.results[0].index[2].des||"",i=t.results[0].weather_data[0].weather||"",r={data:e+" "+i,type:"weather"};n.add(r),n.init()}})}),requirejs(["jquery","moveMountainFactory"],function(t,e){var i=[{$item:t(".layer-mountain1"),factor:5},{$item:t(".layer-mountain2"),factor:2},{$item:t(".layer-mountain3"),factor:1}],n=e(i,100);n.init();var r=[{$item:t(".intro-layers .intro-bg1"),factor:5},{$item:t(".intro-layers .intro-bg2"),factor:2}],r=e(r,200);r.init()}),requirejs(["jquery","CarsouelModel"],function(t,e){var i=e.create(),n=t(".mod-carousel"),r=n.find(".pannel-ct"),o=r.find(".pannel"),a=o.first().outerWidth(),s=n.find(".prev"),u=n.find(".next"),c={$screen:n,curIdx:0,$container:r,$lists:o,width:a,$prev:s,$next:u};i.init(c)}),requirejs(["jquery","utils","bigEventModel"],function(t,e,i){var n=i.create(),r=t(".event-ct"),o=r.find(".events"),a=r.find(".prev"),s=r.find(".next"),u=o.find("li"),c=t(window).width(),l={$screen:r,$container:o,$prev:a,$next:s,$lists:u,width:c,curIdx:0};n.init(l);var d=t(".timeline"),u=d.find("li");d.on("mouseenter","li",function(){var i=t(this).index();e.Event.fire("timelineMove",i)}),e.Event.listen("carsouelMove",function(t){u.removeClass("active"),u.eq(t).addClass("active")})}),requirejs(["app/dialog"],function(t){t.init()}),define("app/main",function(){});